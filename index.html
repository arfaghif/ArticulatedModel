<!DOCTYPE html>



<html>

<head>
    <link rel="stylesheet" href="style.css">

    <script id="vertex-shader" type="x-shader/x-vertex">

        /* bump map vertex shader */
        varying vec3 L; /* light vector in texture-space coordinates */
        varying vec3 V; /* view vector in texture-space coordinates */

        uniform vec4 normal;
        uniform vec3 objTangent; /* tangent vector in object coordinates */

        attribute  vec4 vPosition;
        attribute vec4 vColor;
        attribute  vec3 vNormal;
        attribute  vec2 vTexCoord;
        
        varying vec3 R;
        varying vec4 fColor;
        varying vec4 fLighting;
        varying vec2 fTexCoord;
        
        
        uniform vec4 ambientProduct, diffuseProduct, specularProduct;
        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        uniform mat3 normalMatrix;
        uniform vec4 lightPosition;
        uniform float shininess;

        uniform vec3 theta;

        void main()
        {           
        vec3 pos = (modelViewMatrix * vPosition).xyz;
            
            //fixed light postion
            
            vec3 light = lightPosition.xyz;
            vec3 L = normalize( light - pos );
        
            
            vec3 E = normalize( -pos );
            vec3 H = normalize( L + E );
            
            vec4 NN = vec4(vNormal,0);
        
            // Transform vertex normal into eye coordinates
               
            vec3 N = normalize( (modelViewMatrix*NN).xyz);
        
            // Compute terms in the illumination equation
            vec4 ambient = ambientProduct;
        
            float Kd = max( dot(L, N), 0.0 );
            vec4  diffuse = Kd*diffuseProduct;
        
            float Ks = pow( max(dot(N, H), 0.0), shininess );
            vec4  specular = Ks * specularProduct;
            
            if( dot(L, N) < 0.0 ) {
            specular = vec4(0.0, 0.0, 0.0, 1.0);
            } 
        
            gl_Position = projectionMatrix * modelViewMatrix * vPosition;
            fLighting = ambient + diffuse +specular;
            fColor = vColor;
            fTexCoord = vTexCoord;

            //env map
            vec3 eyePos  = (modelViewMatrix*vPosition).xyz;
            vec3 eyeLightPos = (modelViewMatrix*lightPosition).xyz;
            R = reflect(eyePos, N);

            /* normal, tangent and binormal in eye coordinates */

            vec3 NNN = normalize(normalMatrix*normal.xyz);
            vec3 T  = normalize(normalMatrix*objTangent);
            vec3 B = cross(NNN, T);
        
            /* light vector in texture space */
        
            L.x = dot(T, eyeLightPos-eyePos);
            L.y = dot(B, eyeLightPos-eyePos);
            L.z = dot(NNN, eyeLightPos-eyePos);
        
            L = normalize(L);
        
            /* view vector in texture space */
        
            V.x = dot(T, -eyePos);
            V.y = dot(B, -eyePos);
            V.z = dot(NNN, -eyePos);
        
            V = normalize(V);
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;


        varying vec4 fColor;
        
        varying vec4 fLighting;
        vec4 shaderColor;
        varying vec3 R;
        varying vec3 L;
        varying vec3 V;

        uniform int textureOn;
        uniform bool shaderOn;
        
        varying  vec2 fTexCoord;

        uniform sampler2D Tex0;
        uniform sampler2D Tex1;
        uniform sampler2D Tex2;
        uniform samplerCube texMap;

        uniform vec4 diffuseProductBump;
        
        void main()
        {   
            vec4 N = texture2D(Tex2, fTexCoord);
            vec3 NN =  normalize(2.0*N.xyz-1.0);
            vec3 LL = normalize(L);
            float Kd = max(dot(NN, LL), 0.0);
            if(shaderOn){
                shaderColor = fColor * fLighting;
            } else{
                shaderColor = fColor;
            }
            if(textureOn == 1){
                gl_FragColor = shaderColor*(texture2D(Tex0, fTexCoord)*texture2D(Tex1, fTexCoord));
            }
            else if(textureOn == 2){
                gl_FragColor = textureCube(texMap, R);
            }
            else if(textureOn == 3) {
                gl_FragColor = vec4(Kd*diffuseProductBump.xyz, 0.75);
            }
            else {
                gl_FragColor = shaderColor;
            }
        }

    </script>

    <script type="text/javascript" src="webgl/utils/webgl-utils.js"></script>
    <script type="text/javascript" src="webgl/utils/initShaders.js"></script>
    <script type="text/javascript" src="webgl/utils/MV.js"></script>
    <script type="text/javascript" src="webgl/utils/colors.js"></script>
    <script type="text/javascript" src="webgl/shapes/shape.js"></script>
    <script type="text/javascript" src="webgl/shapes/simple/simpleShape.js"></script>
    <script type="text/javascript" src="webgl/shapes/simple/pyramid.js"></script>
    <script type="text/javascript" src="webgl/shapes/simple/cube.js"></script>
    <script type="text/javascript" src="webgl/shapes/simple/rectangle.js"></script>
    <script type="text/javascript" src="webgl/shapes/composite/compositeShape.js"></script>
    <script type="text/javascript" src="webgl/shapes/composite/hollowCube.js"></script>
    <script type="text/javascript" src="webgl/shapes/composite/dustbinBody.js"></script>
    <script type="text/javascript" src="webgl/shapes/composite/dustbinCap.js"></script>

    <script type="text/javascript" src="webgl/shapes/articulated/articulatedShape.js"></script>
    <script type="text/javascript" src="webgl/shapes/articulated/hand.js"></script>
    <script type="text/javascript" src="webgl/shapes/articulated/chainCube.js"></script>
    <script type="text/javascript" src="webgl/shapes/articulated/dustbin.js"></script>
    <script type="text/javascript" src="webgl/mywebgl.js"></script>
    <script type="text/javascript" src="inputListeners.js"></script>
    <script type="text/javascript" src="webgl/utils/saveload.js"></script>
    
</head>

<body>
    <div>
        Finger angle -180 <input id="slider1" type="range"
         min="-180" max="180" step="10" value="0"
          />
         180
        </div><br/>
        
        <div>
        Finger sub angle -180 <input id="slider2" type="range"
         min="-180" max="180" step="10" value="0"
          />
         180
        </div><br/>
    <canvas id="gl-canvas">
        Oops ... your browser doesn't support the HTML5 canvas element
    </canvas>
    <div style="margin-top: 20px;">
        <div> Projection type:
            <select name="projection" id="projectionDropdown">
                <option value="perspective">Perspective</option>
                <option value="oblique">Oblique</option>
                <option value="orthographic">Orthographic</option>
            </select>
        </div>
        <div> <input id="followObjectCheckbox" type="checkbox" /> camera follows object </div>
        </br>
        <div> Shading:
            <select name="shading" id="shadingDropdown">
                <option value="ON">ON</option>
                <option value="OFF">OFF</option>
            </select>
        </div>
        <div> Texture:
            <select name="texture" id="textureDropdown">
                <option value="Off">Off</option>
                <option value="Pattern">Pattern</option>
                <option value="Environment">Environment</option>
                <option value="Bump">Bump</option>
            </select>
        </div>

        <div ">
            <button id="clearButton" style="background-color: rgb(189, 189, 111);">Clear</button>
            <button id="resetButton" style="background-color: rgb(216, 124, 71);">Reset</button>
            <button id="hollowCubeButton">Hand</button>
            <button id="hollowChairButton">Cube Chain</button>
            <button id="hollowMineButton">Dustbin</button>
        </div>
        <button id="saveButton">Save</button>
        <button id="loadButton" style="margin:5px;background-color: rgb(159, 176, 194);">Load
            <input style="margin-left: 4px;margin-right: 3px;" type="file" id="fileSelector" accept=".json" autocomplete="off">
        </button>    
        <div class="popup" id="help">Helper
                <span class="popuptext" id="myPopup">
                    <h2>HOLLOW HELPER</h2>
                    <p>Click any object button to start drawing
                    </br>Object color will generate randomly
                    </p>
                    <p>Arrow up-down to zoom in-out</p>
                    <p>
                        Arrow left-right to change shape selection.</br>
                        Most left obyek is camera, obyek start from 2nd most left                   
                    </p>
                    <p>WASDQE to move</p>
                    <p>IJKLUO to rotate camera</p>
                    <p>Arrow up-down to zoom in-out</p>
                    <p>Clear button to clear all objects in canvas</p>
                    <p>Reset button to reset camera view</p>
                    <P>Use projection type dropdown for switching projection</P>
                    <p>Use shader drodown to set shader ON/OFF</p>
                    <p>There are also save and load button to save or load to/from file</p>
                    <p>...Click Helper button to close helper view</p>
                    


                </span>
        </div>
    </br>
        
    </div>
    </br>
    

    <script type="text/javascript" src="script.js"></script>
</body>

</html>